<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ficha de Adesão</title>
<!-- Adicione no <head> -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
<style>
  body {
    background-color: #25577a;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
    font-family: Arial, sans-serif;
    margin: 20px 0;
  }

  .col-12{
    justify-content: center;
    align-items: center;
    display: flex;
    width: 100%;
  }

  .caixa-form {
    background: #fff;
    padding: 30px;
    border-radius: 8px;
    width: auto;
    margin-bottom: 20px;
    min-width: 300px;
    max-width: 600px;
  }

  canvas {
    border: 2px dashed #e3e3e3;
    border-radius: 5px;
    width: 100%;
    height: 200px;
    touch-action: none;
    margin-bottom: 10px;
  }

    canvas:hover {
    border: 2px dashed #8d8d8d;
    border-radius: 5px;
    width: 100%;
    height: 200px;
    touch-action: none;
    margin-bottom: 10px;
  }

  .btn-limpar {
    background-color: #6d6d6d;
    color: #fff;
    margin-bottom: 10px;
  }

  .btn-limpar:hover {
    background-color: #555;
    color: #fff;
  }

  .btn-primary, .btn-success{
    border: none !important;
    background-color: #000 !important;
  }
</style>
</head>
<body>
  <div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="caixa-form">
        <h3 class="text-center mb-4">Ficha de Adesão</h3>
        <hr>
        <br>
        <form id="formulario">
          <label for="nome" class="form-label">Nome</label>
          <input type="text" id="nome" class="form-control" placeholder="Digite seu nome" required>

          <label for="sap" class="form-label mt-3">SAP</label>
          <input type="text" id="sap" class="form-control" placeholder="Digite seu SAP" required>

          <label for="cpf" class="form-label mt-3">CPF</label>
          <input type="text" id="cpf" class="form-control" placeholder="Digite seu CPF" required>

          <label class="form-label mt-3">Assinatura</label>
          <canvas id="canvasAssinatura" width="500" height="200"></canvas>
          <button type="button" id="btnLimpar" class="btn btn-limpar w-100">Limpar Assinatura</button>

          <button type="submit" class="btn btn-primary w-100 mt-2">Salvar Assinatura</button>
        </form>
      </div>
    </div>

    <div class="col-12">
      <div class="caixa-form">
        <h5>Lista de Pessoas que Assinaram:</h5>
        <ul id="listaAssinaturas" class="list-group mb-3"></ul>
        <button id="baixarExcel" class="btn btn-success w-100">Baixar Excel</button>
      </div>
    </div>
  </div>
</div>




<script>
  // -------------------- Canvas --------------------
  const canvas = document.getElementById("canvasAssinatura");
  const caneta = canvas.getContext("2d");
  let desenhando = false;

  function comecarDesenho(e) {
    desenhando = true;
    caneta.beginPath();
    const pos = pegarPosicao(e);
    caneta.moveTo(pos.x, pos.y);
  }

  function desenhar(e) {
    if (!desenhando) return;
    const pos = pegarPosicao(e);
    caneta.lineTo(pos.x, pos.y);
    caneta.stroke();
  }

  function pararDesenho() {
    desenhando = false;
  }

  function pegarPosicao(e) {
    const rect = canvas.getBoundingClientRect();
    if (e.touches) {
      return {
        x: e.touches[0].clientX - rect.left,
        y: e.touches[0].clientY - rect.top
      };
    } else {
      return { x: e.offsetX, y: e.offsetY };
    }
  }

  canvas.addEventListener("mousedown", comecarDesenho);
  canvas.addEventListener("mousemove", desenhar);
  canvas.addEventListener("mouseup", pararDesenho);
  canvas.addEventListener("mouseout", pararDesenho);
  canvas.addEventListener("touchstart", comecarDesenho);
  canvas.addEventListener("touchmove", desenhar);
  canvas.addEventListener("touchend", pararDesenho);

  document.getElementById("btnLimpar").addEventListener("click", function() {
    caneta.clearRect(0, 0, canvas.width, canvas.height);
  });

  // -------------------- Lista de assinaturas --------------------
  const lista = document.getElementById("listaAssinaturas");

  function atualizarLista() {
    lista.innerHTML = "";
    let dados = JSON.parse(localStorage.getItem("assinaturas")) || [];
    dados.forEach(item => {
      const li = document.createElement("li");
      li.className = "list-group-item";
      li.textContent = `${item.nome} - ${item.sap}`;
      lista.appendChild(li);
    });
  }

  atualizarLista();

  // -------------------- Salvar assinatura --------------------
// ...existing code...
document.getElementById("formulario").addEventListener("submit", function(e) {
  e.preventDefault();

  const nome = document.getElementById("nome").value.trim();
  const sap = document.getElementById("sap").value.trim();
  const cpf = document.getElementById("cpf").value.trim();

  if (!nome || !sap || !cpf) {
    alert("Preencha nome, SAP e CPF antes de salvar.");
    return;
  }

  // Salvar no localStorage
  let dados = JSON.parse(localStorage.getItem("assinaturas")) || [];
  dados.push({ nome, sap, cpf });
  localStorage.setItem("assinaturas", JSON.stringify(dados));
  atualizarLista();

  // Baixar assinatura como PNG
  const link = document.createElement("a");
  link.download = `${nome} - ${sap}.png`;
  link.href = canvas.toDataURL("image/png");
  link.click();

  // Gerar PDF bonitinho
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  // Título
  doc.setFont("helvetica", "bold");
  doc.setFontSize(18);
  doc.text("Ficha de Adesão", 105, 20, { align: "center" });

  doc.setFontSize(12);
  doc.setFont("helvetica", "normal");
  doc.text(`Nome: ${nome}`, 20, 40);
  doc.text(`SAP: ${sap}`, 20, 50);
  doc.text(`CPF: ${cpf}`, 20, 60);

  // Adiciona assinatura como imagem
  const imgData = canvas.toDataURL("image/png");
  doc.text("Assinatura:", 20, 75);
  doc.addImage(imgData, "PNG", 20, 80, 80, 40);

  // Rodapé
  doc.setFontSize(10);
  doc.setTextColor(120);
  doc.text("Gerado automaticamente pelo sistema de adesão.", 20, 135);

  doc.save(`${nome} - ${sap}.pdf`);

  // Limpar formulário e canvas
  document.getElementById("nome").value = "";
  document.getElementById("sap").value = "";
  document.getElementById("cpf").value = "";
  caneta.clearRect(0, 0, canvas.width, canvas.height);
});
// ...existing code...

  // -------------------- Baixar Excel --------------------
document.getElementById("baixarExcel").addEventListener("click", function() {
  let dados = JSON.parse(localStorage.getItem("assinaturas")) || [];
  if(dados.length === 0){
    alert("Nenhuma assinatura para baixar!");
    return;
  }

  // Transformar dados em formato de planilha
  const ws_data = [
    ["Nome", "SAP", "CPF"],  // cabeçalho
    ...dados.map(item => [item.nome, item.sap, item.cpf])
  ];

  const ws = XLSX.utils.aoa_to_sheet(ws_data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Assinaturas");

  // Baixar arquivo Excel
  XLSX.writeFile(wb, "assinaturas.xlsx");
});


</script>

</body>
</html>
